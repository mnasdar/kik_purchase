import{$ as t}from"./modal-handler-2823516c.js";import{i as E}from"./data-table-e496d1b5.js";import{b as u}from"./gridjs.module-3ea5c5ab.js";import{s as r}from"./index-88056f3d.js";import{t as _}from"./tippy.all-093076db.js";import{s as o,c as w,a as m}from"./notification-d92c8c7c.js";import"./_commonjsHelpers-725317a4.js";import"./parse-c3570fb2.js";import"./glightbox.min-3fffbd26.js";import"./notification-5f085df9.js";let b=[];function S(){if(!t("#table-classifications").length)return;const a=[{id:"number",name:"#",width:"60px"},{id:"name",name:"Nama Klasifikasi",width:"250px",formatter:e=>u("div",{innerHTML:e})},{id:"purchase_request_items_count",name:"PR Items",width:"130px",formatter:e=>u("div",{innerHTML:e})},{id:"created_at",name:"Dibuat",width:"150px",formatter:e=>u("div",{innerHTML:e})},{id:"actions",name:"Actions",width:"120px",formatter:e=>u("div",{innerHTML:e})}],i=[{selector:"#btn-delete-selected",when:"multiple"}];E({tableId:"#table-classifications",dataUrl:r("klasifikasi.data"),columns:a,enableCheckbox:!0,buttonConfig:i,limit:10,enableFilter:!1,onDataLoaded:e=>{t("#data-count").text(e.length),M(),T()}})}function M(){b.forEach(i=>i.destroy()),b=[];const a=document.querySelectorAll('#table-classifications [data-plugin="tippy"]');a.length&&(b=_(a,{arrow:!0}))}function T(){t(document).on("click",".btn-view-pr-items",function(a){a.preventDefault();const i=t(this).data("classification-id");t(this).data("classification-name"),i&&(window.location.href=r("klasifikasi.pr-items",i))})}function B(){const a=t("#table-classifications").data("grid");a&&(o("Memuat data...","info",1e3),t.ajax({url:r("klasifikasi.data"),method:"GET",success:function(i){const e=i.map(s=>[s.checkbox,s.number,s.type,s.name,s.purchase_request_items_count,s.created_at,s.actions]);a.updateConfig({data:e}).forceRender(),t("#data-count").text(i.length),setTimeout(()=>{M(),T()},300),o("Data berhasil direfresh","success",1500)},error:function(i){console.error("Error loading data:",i),o("Gagal memuat data","error",2e3)}}))}function D(){t("#btn-refresh").on("click",function(){B()})}function O(){const a=t("#classificationModal"),i=t("#classificationModalBackdrop"),e=t("#classificationModalContent");a.removeClass("hidden").css("opacity","1"),requestAnimationFrame(()=>{i.css("opacity","1"),e.css({transform:"scale(1)",opacity:"1"})})}function d(){const a=t("#classificationModalBackdrop"),i=t("#classificationModalContent");a.css("opacity","0"),i.css({transform:"scale(0.95)",opacity:"0"}),setTimeout(()=>{t("#classificationModal").addClass("hidden").css("opacity","0"),C()},300)}function C(){t("#classificationForm")[0].reset(),t("#classification_id").val(""),t("#form_method").val("POST"),t("[id^='error-']").addClass("hidden").text(""),t("#classificationForm input, #classificationForm select, #classificationForm textarea").removeClass("border-red-500")}function y(a){t("[id^='error-']").addClass("hidden").text(""),t("#classificationForm input, #classificationForm select, #classificationForm textarea").removeClass("border-red-500");for(const[e,s]of Object.entries(a)){const c=t(`#error-${e}`),n=t(`#${e}`);c.length&&n.length&&(c.removeClass("hidden").text(s[0]),n.addClass("border-red-500"))}const i=t("#classificationForm .border-red-500").first();i.length&&i.focus()}function A(){t("#classificationForm").on("submit",function(a){a.preventDefault(),t("#classificationFormSubmit").trigger("click")})}function N(){t("#btn-create-classification").on("click",function(){C(),t("#classificationModalTitle").text("Tambah Klasifikasi"),t("#classificationModalIcon").removeClass("mgc_edit_line").addClass("mgc_classify_2_line"),t("#submitButtonText").text("Simpan"),o("Form siap untuk diisi","info",1500),O()})}function j(){t("#classificationFormSubmit").on("click",async function(){var c,n,g;const a=t(this),i=t("#submitButtonText").text();if(t("#form_method").val()==="PUT")return;a.prop("disabled",!0),t("#submitButtonText").html('<i class="mgc_loading_line animate-spin mr-2"></i>Menyimpan...');const s={name:t("#name").val()};try{const l=await t.ajax({url:r("klasifikasi.store"),method:"POST",data:s,dataType:"json",headers:{"X-CSRF-TOKEN":t('meta[name="csrf-token"]').attr("content")}});d(),o("Klasifikasi berhasil ditambahkan!","success",2e3),setTimeout(()=>location.reload(),500)}catch(l){if(l.status===409&&((c=l.responseJSON)==null?void 0:c.status)==="soft-deleted"){const F=t("#name").val();if(!await w(`Data "${F}" sudah pernah ditambahkan dan dinonaktifkan. Aktifkan kembali?`,"Aktifkan data?")){o("Data tidak diaktifkan. Anda tetap di form ini.","info",2e3);return}try{await t.ajax({url:r("klasifikasi.store"),method:"POST",data:{...s,reactivate:!0,reactivate_id:l.responseJSON.id},dataType:"json",headers:{"X-CSRF-TOKEN":t('meta[name="csrf-token"]').attr("content")}}),d(),o("Klasifikasi diaktifkan kembali dan diperbarui!","success",2e3),setTimeout(()=>location.reload(),500)}catch(k){k.status===422?(y(k.responseJSON.errors),o("Mohon periksa kembali data yang Anda masukkan","error",3e3)):m(((n=k.responseJSON)==null?void 0:n.message)||"Terjadi kesalahan saat menyimpan data","Gagal!")}}else l.status===422?(y(l.responseJSON.errors),o("Mohon periksa kembali data yang Anda masukkan","error",3e3)):m(((g=l.responseJSON)==null?void 0:g.message)||"Terjadi kesalahan saat menyimpan data","Gagal!")}finally{a.prop("disabled",!1),t("#submitButtonText").text(i)}})}function $(){t("#classificationModalClose, #classificationModalCancel").on("click",d),t("#classificationModal").on("click",function(a){t(a.target).is("#classificationModal")&&d()}),t(document).on("keydown",function(a){a.key==="Escape"&&(t("#classificationModal").hasClass("hidden")||d())})}let x=null;function K(){const a=t("#classificationModal"),i=t("#classificationModalBackdrop"),e=t("#classificationModalContent");a.removeClass("hidden").css("opacity","1"),requestAnimationFrame(()=>{i.css("opacity","1"),e.css({transform:"scale(1)",opacity:"1"})})}function I(){const a=t("#classificationModalBackdrop"),i=t("#classificationModalContent");a.css("opacity","0"),i.css({transform:"scale(0.95)",opacity:"0"}),setTimeout(()=>{t("#classificationModal").addClass("hidden").css("opacity","0")},300)}function G(a){t("[id^='error-']").addClass("hidden").text(""),t("#classificationForm input, #classificationForm select, #classificationForm textarea").removeClass("border-red-500");for(const[e,s]of Object.entries(a)){const c=t(`#error-${e}`),n=t(`#${e}`);c.length&&n.length&&(c.removeClass("hidden").text(s[0]),n.addClass("border-red-500"))}const i=t("#classificationForm .border-red-500").first();i.length&&i.focus()}function P(){t(document).on("click",".btn-edit-classification",async function(){const a=t(this).data("id");x=a;try{const i=await t.get(r("klasifikasi.show",a));t("#classification_id").val(i.id),t("#name").val(i.name),t("#form_method").val("PUT"),t("#classificationModalTitle").text("Edit Klasifikasi"),t("#classificationModalIcon").removeClass("mgc_classify_2_line").addClass("mgc_edit_line"),t("#submitButtonText").text("Update"),K()}catch(i){console.error("Error fetching classification:",i),m("Gagal mengambil data klasifikasi","Gagal!")}})}function J(){t("#classificationFormSubmit").on("click",async function(){var c;const a=t(this),i=t("#submitButtonText").text();if(t("#form_method").val()!=="PUT")return;a.prop("disabled",!0),t("#submitButtonText").html('<i class="mgc_loading_line animate-spin mr-2"></i>Menyimpan...');const s={name:t("#name").val()};try{const n=await t.ajax({url:r("klasifikasi.update",x),method:"PUT",data:s,dataType:"json",headers:{"X-CSRF-TOKEN":t('meta[name="csrf-token"]').attr("content")}});I(),o("Klasifikasi berhasil diperbarui!","success",2e3),setTimeout(()=>location.reload(),500)}catch(n){n.status===422?(G(n.responseJSON.errors),o("Mohon periksa kembali data yang Anda masukkan","error",3e3)):m(((c=n.responseJSON)==null?void 0:c.message)||"Terjadi kesalahan saat menyimpan data","Gagal!")}finally{a.prop("disabled",!1),t("#submitButtonText").text(i)}})}let f=null,h="single";function v(){const a=t("#deleteModal"),i=t("#deleteModalBackdrop"),e=t("#deleteModalContent");a.removeClass("hidden").css("opacity","1"),requestAnimationFrame(()=>{i.css("opacity","1"),e.css({transform:"scale(1)",opacity:"1"})})}function p(){const a=t("#deleteModalBackdrop"),i=t("#deleteModalContent");a.css("opacity","0"),i.css({transform:"scale(0.95)",opacity:"0"}),setTimeout(()=>{t("#deleteModal").addClass("hidden").css("opacity","0")},300)}function R(){t(document).on("click",".btn-delete-classification",function(){h="single",f=t(this).data("id");const a=t(this).data("name");t("#deleteMessage").text(`Apakah Anda yakin ingin menghapus klasifikasi "${a}"?`),v()})}function L(){t("#btn-delete-selected").on("click",function(){const a=[];if(t("#table-classifications input[type='checkbox']:checked").each(function(){a.push(t(this).val())}),a.length===0){o("Pilih klasifikasi yang ingin dihapus","warning",2e3);return}h="bulk",f=a,t("#deleteMessage").text(`Apakah Anda yakin ingin menghapus ${a.length} klasifikasi?`),v()})}function U(){t("#deleteModalConfirm").on("click",async function(){var i;const a=t(this);a.prop("disabled",!0).text("Menghapus...");try{h==="single"?await t.ajax({url:r("klasifikasi.destroy",f),method:"DELETE",headers:{"X-CSRF-TOKEN":t('meta[name="csrf-token"]').attr("content")}}):await t.ajax({url:r("klasifikasi.bulkDestroy"),method:"DELETE",data:{ids:f},headers:{"X-CSRF-TOKEN":t('meta[name="csrf-token"]').attr("content")}}),p();const e=h==="single"?"Klasifikasi berhasil dihapus!":`${f.length} klasifikasi berhasil dihapus!`;o(e,"success",2e3),setTimeout(()=>location.reload(),500)}catch(e){m(((i=e.responseJSON)==null?void 0:i.message)||"Gagal menghapus data","Gagal!")}finally{a.prop("disabled",!1).text("Hapus")}})}function q(){t("#deleteModalCancel").on("click",p),t("#deleteModal").on("click",function(a){t(a.target).is("#deleteModal")&&p()}),t(document).on("keydown",function(a){a.key==="Escape"&&(t("#deleteModal").hasClass("hidden")||p())})}t(document).ready(function(){S(),D(),N(),j(),A(),$(),P(),J(),R(),L(),U(),q()});
