import{$ as e}from"./modal-handler-2823516c.js";import{i as F}from"./data-table-e496d1b5.js";import{b as l}from"./gridjs.module-3ea5c5ab.js";import{s as p}from"./index-88056f3d.js";import{t as _}from"./tippy.all-093076db.js";import{s as r,c as E,a as c}from"./notification-d92c8c7c.js";import"./_commonjsHelpers-725317a4.js";import"./parse-c3570fb2.js";import"./glightbox.min-3fffbd26.js";import"./notification-5f085df9.js";let k=[];function S(){if(!e("#table-suppliers").length)return;const a=[{id:"number",name:"#",width:"60px"},{id:"supplier_type",name:"Type",width:"100px",formatter:t=>l("div",{innerHTML:t})},{id:"name",name:"Nama Supplier",width:"200px",formatter:t=>l("div",{innerHTML:t})},{id:"contact_person",name:"Contact Person",width:"150px",formatter:t=>l("div",{innerHTML:t})},{id:"phone",name:"Telepon",width:"140px",formatter:t=>l("div",{innerHTML:t})},{id:"email",name:"Email",width:"200px",formatter:t=>l("div",{innerHTML:t})},{id:"created_by",name:"Created By",width:"150px",formatter:t=>l("div",{innerHTML:t})},{id:"npwp",name:"NPWP",width:"150px",formatter:t=>l("div",{innerHTML:t})},{id:"actions",name:"Actions",width:"80px",formatter:t=>l("div",{innerHTML:t})}],n=[{selector:"#btn-delete-selected",when:"multiple"}];F({tableId:"#table-suppliers",dataUrl:p("supplier.data"),columns:a,enableCheckbox:!0,buttonConfig:n,limit:10,enableFilter:!1,onDataLoaded:t=>{e("#data-count").text(t.length),x()}})}function x(){k.forEach(n=>n.destroy()),k=[];const a=document.querySelectorAll('#table-suppliers [data-plugin="tippy"]');a.length&&(k=_(a))}function D(){const a=e("#table-suppliers").data("grid");a&&(r("Memuat data...","info",1e3),e.ajax({url:p("supplier.data"),method:"GET",success:function(n){const t=n.map(o=>[o.checkbox,o.number,o.supplier_type,o.name,o.contact_person,o.phone,o.email,o.created_by,o.npwp,o.actions]);a.updateConfig({data:t}).forceRender(),e("#data-count").text(n.length),setTimeout(()=>{x()},300),r("Data berhasil direfresh","success",1500)},error:function(n){console.error("Error loading data:",n),r("Gagal memuat data","error",2e3)}}))}function A(){e("#btn-refresh").on("click",function(){D()})}function B(){const a=e("#supplierModal"),n=e("#supplierModalBackdrop"),t=e("#supplierModalContent");a.removeClass("hidden").css("opacity","1"),requestAnimationFrame(()=>{n.css("opacity","1"),t.css({transform:"scale(1)",opacity:"1"})})}function u(){const a=e("#supplierModalBackdrop"),n=e("#supplierModalContent");a.css("opacity","0"),n.css({transform:"scale(0.95)",opacity:"0"}),setTimeout(()=>{e("#supplierModal").addClass("hidden").css("opacity","0"),C()},300)}function C(){e("#supplierForm")[0].reset(),e("#supplier_id").val(""),e("#form_method").val("POST"),e("[id^='error-']").addClass("hidden").text(""),e("#supplierForm input, #supplierForm select, #supplierForm textarea").removeClass("border-red-500")}function T(a){e('[id^="error-"]').addClass("hidden").text(""),e("#supplierForm input, #supplierForm select, #supplierForm textarea").removeClass("border-red-500");for(const[t,o]of Object.entries(a)){const s=e(`#error-${t}`),i=e(`[name="${t}"]`);s.length&&(s.removeClass("hidden").text(o[0]),i.addClass("border-red-500"))}const n=e("#supplierForm .border-red-500").first();n.length&&n.focus()}function G(){e("#supplierForm").on("submit",function(a){a.preventDefault(),e("#supplierFormSubmit").trigger("click")})}function j(){e("#btn-create-supplier").on("click",function(){C(),e("#supplierModalTitle").text("Tambah Supplier"),e("#supplierModalIcon").removeClass("mgc_edit_line").addClass("mgc_contacts_line"),e("#submitButtonText").text("Simpan"),r("Form siap untuk diisi","info",1500),B()})}function $(){e("#supplierFormSubmit").on("click",async function(){const a=e(this),n=e("#submitButtonText").text();if(e("#form_method").val()!=="PUT"){a.prop("disabled",!0),e("#submitButtonText").html('<i class="mgc_loading_line animate-spin mr-2"></i>Menyimpan...');try{const o=new FormData(e("#supplierForm")[0]),s=await fetch(p("supplier.store"),{method:"POST",headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content"),Accept:"application/json"},body:o}),i=await s.json();if(s.ok)u(),r("Supplier berhasil ditambahkan!","success",2e3),setTimeout(()=>location.reload(),500);else if(s.status===409&&i.status==="soft-deleted"){const d=e("#name").val();if(!await E(`Data "${d}" sudah pernah ditambahkan dan dinonaktifkan. Aktifkan kembali?`,"Aktifkan data?")){r("Data tidak diaktifkan. Anda tetap di form ini.","info",2e3);return}const h=new FormData(e("#supplierForm")[0]);h.append("reactivate","1"),h.append("reactivate_id",i.id);const M=await fetch(p("supplier.store"),{method:"POST",headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content"),Accept:"application/json"},body:h}),b=await M.json();M.ok?(u(),r("Supplier diaktifkan kembali dan diperbarui!","success",2e3),setTimeout(()=>location.reload(),500)):b.errors?(T(b.errors),r("Mohon periksa kembali data yang Anda masukkan","error",3e3)):c(b.message||"Terjadi kesalahan saat menyimpan data","Gagal!")}else i.errors?(T(i.errors),r("Mohon periksa kembali data yang Anda masukkan","error",3e3)):c(i.message||"Terjadi kesalahan saat menyimpan data","Gagal!")}catch(o){c("Gagal menyimpan data supplier","Gagal!"),console.error(o)}finally{a.prop("disabled",!1),e("#submitButtonText").text(n)}}})}function P(){e("#supplierModalClose, #supplierModalCancel").on("click",u),e("#supplierModal").on("click",function(a){a.target===this&&u()}),e(document).on("keydown",function(a){a.key==="Escape"&&(e("#supplierModal").hasClass("hidden")||u())})}let v=null;function L(){const a=e("#supplierModal"),n=e("#supplierModalBackdrop"),t=e("#supplierModalContent");a.removeClass("hidden").css("opacity","1"),requestAnimationFrame(()=>{n.css("opacity","1"),t.css({transform:"scale(1)",opacity:"1"})})}function O(){const a=e("#supplierModalBackdrop"),n=e("#supplierModalContent");a.css("opacity","0"),n.css({transform:"scale(0.95)",opacity:"0"}),setTimeout(()=>{e("#supplierModal").addClass("hidden").css("opacity","0")},300)}function H(a){e('[id^="error-"]').addClass("hidden").text(""),e("#supplierForm input, #supplierForm select, #supplierForm textarea").removeClass("border-red-500");for(const[t,o]of Object.entries(a)){const s=e(`#error-${t}`),i=e(`[name="${t}"]`);s.length&&(s.removeClass("hidden").text(o[0]),i.addClass("border-red-500"))}const n=e("#supplierForm .border-red-500").first();n.length&&n.focus()}function I(){e(document).on("click",".btn-edit-supplier",async function(){const a=e(this).data("id");v=a;try{const t=await(await fetch(p("supplier.show",{supplier:a}))).json();e("#supplier_id").val(t.id),e("#form_method").val("PUT"),e(`input[name="supplier_type"][value="${t.supplier_type}"]`).prop("checked",!0),e("#name").val(t.name),e("#contact_person").val(t.contact_person),e("#phone").val(t.phone),e("#email").val(t.email),e("#address").val(t.address),e("#tax_id").val(t.tax_id),e("#supplierModalTitle").text("Edit Supplier"),e("#supplierModalIcon").removeClass("mgc_contacts_line").addClass("mgc_edit_line"),e("#submitButtonText").text("Update"),L()}catch(n){c("Gagal mengambil data supplier","Gagal!"),console.error(n)}})}function N(){e("#supplierFormSubmit").on("click",async function(){const a=e(this),n=e("#submitButtonText").text();if(e("#form_method").val()==="PUT"){a.prop("disabled",!0),e("#submitButtonText").html('<i class="mgc_loading_line animate-spin mr-2"></i>Menyimpan...');try{const o=new FormData(e("#supplierForm")[0]),s=await fetch(p("supplier.update",{supplier:v}),{method:"POST",headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content"),Accept:"application/json"},body:o}),i=await s.json();s.ok?(O(),r("Supplier berhasil diperbarui!","success",2e3),setTimeout(()=>location.reload(),500)):i.errors?(H(i.errors),r("Mohon periksa kembali data yang Anda masukkan","error",3e3)):c(i.message||"Terjadi kesalahan saat menyimpan data","Gagal!")}catch(o){c("Gagal menyimpan data supplier","Gagal!"),console.error(o)}finally{a.prop("disabled",!1),e("#submitButtonText").text(n)}}})}let g=null,m="single";function w(){const a=e("#deleteModal"),n=e("#deleteModalBackdrop"),t=e("#deleteModalContent");a.removeClass("hidden").css("opacity","1"),requestAnimationFrame(()=>{n.css("opacity","1"),t.css({transform:"scale(1)",opacity:"1"})})}function f(){const a=e("#deleteModalBackdrop"),n=e("#deleteModalContent");a.css("opacity","0"),n.css({transform:"scale(0.95)",opacity:"0"}),setTimeout(()=>{e("#deleteModal").addClass("hidden").css("opacity","0")},300)}function R(){e(document).on("click",".btn-delete-supplier",function(){g=e(this).data("id");const a=e(this).data("name");m="single",e("#deleteMessage").text(`Apakah Anda yakin ingin menghapus supplier "${a}"?`),w()})}function U(){e("#btn-delete-selected").on("click",function(){const n=e("#table-suppliers input[type='checkbox']:checked:not(.select-all)").length;if(n===0){r("Pilih supplier yang ingin dihapus","warning",2e3);return}m="bulk",e("#deleteMessage").text(`Apakah Anda yakin ingin menghapus ${n} supplier yang dipilih?`),w()})}function q(){e("#deleteModalConfirm").on("click",async function(){const a=e(this);a.prop("disabled",!0).html('<i class="mgc_loading_line animate-spin mr-2"></i>Menghapus...');try{let n,t;if(m==="single")n=p("supplier.destroy",{supplier:g}),t=new FormData,t.append("_method","DELETE");else{const d=e("#table-suppliers input[type='checkbox']:checked:not(.select-all)").map(function(){return e(this).val()}).get();n=p("supplier.bulkDestroy"),t=new FormData,t.append("_method","DELETE"),d.forEach(y=>t.append("ids[]",y))}const o=await fetch(n,{method:"POST",headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content"),Accept:"application/json"},body:t}),s=await o.json();if(o.ok){f();const i=m==="single"?[g]:e("#table-suppliers input[type='checkbox']:checked:not(.select-all)").map(function(){return e(this).val()}).get(),d=m==="single"?"Supplier berhasil dihapus!":`${i.length} supplier berhasil dihapus!`;r(d,"success",2e3),setTimeout(()=>location.reload(),500)}else c(s.message||"Gagal menghapus supplier","Gagal!")}catch(n){c("Gagal menghapus supplier","Gagal!"),console.error(n)}finally{a.prop("disabled",!1).text("Hapus")}})}function K(){e("#deleteModalCancel").on("click",f),e("#deleteModal").on("click",function(a){a.target===this&&f()}),e(document).on("keydown",function(a){a.key==="Escape"&&(e("#deleteModal").hasClass("hidden")||f())})}e(document).ready(function(){S(),A(),j(),$(),G(),P(),I(),N(),R(),U(),q(),K()});
