import{$ as e}from"./jquery-2823516c.js";import{a as b,b as a}from"./gridjs.module-3ea5c5ab.js";import{s as f}from"./index-88056f3d.js";import{t as g}from"./tippy.all-093076db.js";import{s as l,d as k}from"./notification-0e55581f.js";import"./_commonjsHelpers-725317a4.js";import"./parse-c3570fb2.js";import"./pembayaran-edit-5f085df9.js";let u=null,d={};function x(){return[{id:"checkbox",name:a("div",{innerHTML:'<input type="checkbox" id="headerCheck" class="form-checkbox rounded text-primary">'}),width:"43px",sort:!1,formatter:t=>a("div",{innerHTML:t})},{id:"number",name:"#",width:"50px"},{id:"po_number",name:"PO Number",width:"130px",formatter:t=>a("div",{innerHTML:t})},{id:"pr_number",name:"PR Number",width:"130px",formatter:t=>a("div",{innerHTML:t})},{id:"item_name",name:"Item Description",width:"180px",formatter:t=>a("div",{innerHTML:t})},{id:"quantity",name:"Qty",width:"60px",formatter:t=>a("div",{innerHTML:t})},{id:"po_unit_price",name:"Unit Price",width:"100px",formatter:t=>a("div",{innerHTML:t})},{id:"po_amount",name:"Amount",width:"110px",formatter:t=>a("div",{innerHTML:t})},{id:"po_date",name:"PO Date",width:"90px",formatter:t=>a("div",{innerHTML:t})},{id:"onsite_date",name:"Onsite",width:"90px",formatter:t=>a("div",{innerHTML:t})},{id:"sla_target",name:a("div",{className:"whitespace-normal",innerHTML:"SLA Target"}),width:"70px",formatter:t=>a("div",{innerHTML:t})},{id:"sla_realization",name:a("div",{className:"whitespace-normal",innerHTML:"SLA Real"}),width:"70px",formatter:t=>a("div",{innerHTML:t})},{id:"percent_sla",name:"%",width:"55px",formatter:t=>a("div",{innerHTML:t})},{id:"status",name:"Status",width:"120px",formatter:t=>a("div",{innerHTML:t})},{id:"created_by",name:"Created By",width:"90px",formatter:t=>a("div",{innerHTML:t})}]}function s(t=!1){e.ajax({url:f("po-onsite.data"),method:"GET",data:d,beforeSend:function(){t&&l("Memuat data...","info",1e3)},success:function(i){const o=i.map(n=>[`<input type="checkbox" class="form-checkbox rounded text-primary" value="${n.id}">`,n.number,`<span class="font-semibold text-primary">${n.po_number}</span>`,n.pr_number,n.item_desc,n.quantity,n.po_unit_price,n.po_amount,n.po_date,n.onsite_date,n.sla_target,n.sla_realization,n.percent_sla,n.status,n.created_by]);u?u.updateConfig({data:o}).forceRender():u=new b({columns:x(),data:o,sort:!0,pagination:{enabled:!0,limit:10},search:!0,className:{table:"table-auto w-full",thead:"bg-slate-100 dark:bg-slate-800",th:"px-4 py-3 text-left text-xs font-medium text-slate-700 dark:text-slate-300",td:"px-4 py-3 text-sm text-slate-900 dark:text-slate-100"}}).render(document.getElementById("table-onsite")),e("#data-count").text(i.length),setTimeout(()=>{g("[data-tippy-content]",{arrow:!0,placement:"top"}),M()},100),t&&l("Data berhasil dimuat!","success",1500)},error:function(){k("Gagal memuat data onsite","Error!")}})}function M(){e(document).off("change","#headerCheck").on("change","#headerCheck",function(){const t=e(this).is(":checked");e(".form-checkbox").not(this).prop("checked",t),m()}),e(document).off("change",".form-checkbox").on("change",".form-checkbox",function(){const t=e(".form-checkbox").not("#headerCheck").length===e(".form-checkbox:checked").not("#headerCheck").length;e("#headerCheck").prop("checked",t),m()})}function m(){const t=e(".form-checkbox:checked").not("#headerCheck").length,i=e("#btn-delete-selected"),o=e("#btn-edit-selected");t>0?(i.removeClass("hidden"),o.removeClass("hidden"),e("#delete-count").text(t),e("#edit-count").text(t)):(i.addClass("hidden"),o.addClass("hidden"))}function y(){e("#table-onsite").length&&s(!1)}function v(){e(document).off("click","#btn-refresh").on("click","#btn-refresh",function(){s(!0)})}function C(){e(document).off("click",".btn-edit-onsite").on("click",".btn-edit-onsite",function(){const t=e(this).data("id");window.location.href=f("po-onsite.edit",{po_onsite:t})})}function w(){e(document).off("click","#btn-edit-selected").on("click","#btn-edit-selected",function(){const t=e(".form-checkbox:checked").not("#headerCheck").map(function(){return e(this).val()}).get();if(t.length===0){l("Pilih minimal 1 item untuk diedit","warning",2e3);return}const i=t.join(",");window.location.href=f("po-onsite.bulk-edit",{ids:i})})}function _(){e(document).on("click","#detailOnsiteModalClose, #detailOnsiteModalBackdrop",function(){h()}),e(document).on("keydown",function(t){t.key==="Escape"&&!e("#detailOnsiteModal").hasClass("hidden")&&h()})}function h(){const t=e("#detailOnsiteModalBackdrop"),i=e("#detailOnsiteModalContent"),o=e("#detailOnsiteModal");t.css("opacity","0"),i.css({transform:"scale(0.95)",opacity:"0"}),setTimeout(()=>{o.addClass("hidden").css("opacity","0")},300)}function T(){e(document).off("click","#btn-toggle-filter").on("click","#btn-toggle-filter",function(){e("#filter-section").toggleClass("hidden")}),e(document).off("click","#btn-apply-filter").on("click","#btn-apply-filter",function(){d={po_number:e("#filter-po-number").val(),pr_number:e("#filter-pr-number").val(),item_desc:e("#filter-item-desc").val(),location_id:e("#filter-location").val(),classification_id:e("#filter-classification").val(),current_stage:e("#filter-stage").val(),date_from:e("#filter-date-from").val(),date_to:e("#filter-date-to").val()},Object.keys(d).forEach(t=>{d[t]||delete d[t]}),s(!0)}),e(document).off("click","#btn-clear-filter").on("click","#btn-clear-filter",function(){e("#filter-po-number").val(""),e("#filter-pr-number").val(""),e("#filter-item-desc").val(""),e("#filter-location").val(""),e("#filter-classification").val(""),e("#filter-stage").val(""),e("#filter-date-from").val(""),e("#filter-date-to").val(""),d={},s(!0)})}let c=[];function p(t){const i=e("#deleteModal"),o=e("#deleteModalBackdrop"),n=e("#deleteModalContent");e("#deleteMessage").text(t||"Apakah Anda yakin ingin menghapus data ini?"),i.removeClass("hidden").css("opacity","1"),requestAnimationFrame(()=>{o.css("opacity","1"),n.css({transform:"scale(1)",opacity:"1"})})}function r(){const t=e("#deleteModalBackdrop"),i=e("#deleteModalContent");t.css("opacity","0"),i.css({transform:"scale(0.95)",opacity:"0"}),setTimeout(()=>{e("#deleteModal").addClass("hidden").css("opacity","0"),c=[]},300)}function L(){e(document).off("click",".btn-delete-onsite").on("click",".btn-delete-onsite",function(){const t=e(this).data("id"),i=e(this).data("po-number");c=[t],p(`Apakah Anda yakin ingin menghapus onsite untuk PO "${i}"?`)}),e(document).off("click","#btn-delete-selected").on("click","#btn-delete-selected",function(){const t=e(".form-checkbox:checked").not("#headerCheck");if(!t.length){l("Pilih minimal 1 data untuk dihapus","warning",2e3);return}c=t.map(function(){return e(this).val()}).get(),p(`Apakah Anda yakin ingin menghapus ${c.length} data onsite?`)}),e(document).off("click","#deleteModalConfirm").on("click","#deleteModalConfirm",async function(){var o;const t=e(this),i=t.text();t.prop("disabled",!0).text("Menghapus...");try{await e.ajax({url:f("po-onsite.bulkDestroy"),method:"DELETE",data:{ids:c},headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content")}}),r(),l("Data onsite berhasil dihapus!","success",2e3),setTimeout(()=>window.location.reload(),500)}catch(n){k(((o=n==null?void 0:n.responseJSON)==null?void 0:o.message)||"Gagal menghapus data onsite","Gagal!")}finally{t.prop("disabled",!1).text(i)}}),e(document).off("click","#deleteModalCancel").on("click","#deleteModalCancel",r),e(document).off("click","#deleteModal").on("click","#deleteModal",function(t){e(t.target).is("#deleteModal")&&r()}),e(document).off("keydown.onsite-delete").on("keydown.onsite-delete",function(t){t.key==="Escape"&&!e("#deleteModal").hasClass("hidden")&&r()})}e(document).ready(function(){y(),v(),C(),_(),w(),T(),L()});
