import{$ as e}from"./jquery-2823516c.js";import{f as p}from"./index-a4e39586.js";import{s as l}from"./index-88056f3d.js";import{s as m,d as f}from"./notification-0e55581f.js";import"./_commonjsHelpers-725317a4.js";import"./parse-c3570fb2.js";import"./pembayaran-edit-5f085df9.js";const g=e("[data-onsite-id]").data("onsite-id");function h(n,a){const t=new Date(n),s=new Date(a);let o=0,r=new Date(t);for(;r<=s;){const i=r.getDay();i!==0&&i!==6&&o++,r.setDate(r.getDate()+1)}return o}e(document).ready(function(){e("#form-edit-onsite").length&&D()});function D(){y(),_(),c()}function y(){const n=document.getElementById("onsite_date"),a=e(n).attr("data-date");p("#onsite_date",{dateFormat:"d-M-y",altInput:!0,altFormat:"d-M-y",defaultDate:a,onChange:function(t,s,o){c()}})}function c(){const n=e("#po-approved-date").attr("data-date"),a=e("#onsite_date").val();if(!n||!a)return;const t=a.split("-");if(t.length!==3)return;const s={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},o=t[0].padStart(2,"0"),r=s[t[1]]||"01",d=`${"20"+t[2]}-${r}-${o}`,u=h(n,d);e("#sla_realization").val(u)}function _(){e("#form-edit-onsite").on("submit",async function(n){var o,r;n.preventDefault();const a={onsite_date:b(e("#onsite_date").val()),sla_po_to_onsite_realization:e("#sla_realization").val()||null},t=e("#btn-submit"),s=t.html();t.prop("disabled",!0).html('<i class="mgc_loading_line animate-spin"></i> Mengupdate...'),F();try{await e.ajax({url:l("po-onsite.update",{po_onsite:g}),method:"PUT",data:a,headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content")}}),m("Data onsite berhasil diupdate!","success",2e3),setTimeout(()=>{window.location.href=l("po-onsite.index")},500)}catch(i){i.status===422&&((o=i.responseJSON)!=null&&o.errors)&&v(i.responseJSON.errors),f(((r=i==null?void 0:i.responseJSON)==null?void 0:r.message)||"Gagal mengupdate data onsite","Gagal!"),t.prop("disabled",!1).html(s)}})}function b(n){if(!n)return null;const a=n.split("-");if(a.length!==3)return null;const t={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},s=a[0].padStart(2,"0"),o=t[a[1]]||"01";return`${"20"+a[2]}-${o}-${s}`}function v(n){const a={sla_po_to_onsite_realization:"sla_realization"};Object.keys(n).forEach(t=>{const s=a[t]||t,o=e(`#error-${s}`);o.length&&(o.text(n[t][0]).removeClass("hidden"),e(`#${s}`).addClass("border-danger"))})}function F(){e("[id^='error-']").addClass("hidden").text(""),e(".form-input, .form-select").removeClass("border-danger")}
