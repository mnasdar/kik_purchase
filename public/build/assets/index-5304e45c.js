import{$ as e}from"./jquery-2823516c.js";import{s as h}from"./index-88056f3d.js";import{b as n,a as w}from"./gridjs.module-3ea5c5ab.js";import{t as y}from"./tippy.all-093076db.js";import{s as l,d as P}from"./notification-0e55581f.js";import"./_commonjsHelpers-725317a4.js";import"./parse-c3570fb2.js";import"./pembayaran-edit-5f085df9.js";let p=null,_=null,u=null,c={};function T(){return[{id:"checkbox",name:n("div",{innerHTML:'<input type="checkbox" id="headerCheck" class="form-checkbox rounded text-primary">'}),width:"50px",sort:!1,formatter:t=>n("div",{innerHTML:t})},{id:"number",name:"#",width:"50px"},{id:"request_type",name:"Type",width:"80px",formatter:t=>n("div",{innerHTML:t})},{id:"po_number",name:"PO Number",width:"140px",formatter:t=>n("div",{innerHTML:t})},{id:"supplier",name:"Supplier",width:"130px",formatter:t=>n("div",{innerHTML:t})},{id:"items_count",name:"Items",width:"100px",formatter:t=>n("div",{innerHTML:t})},{id:"total_pr_amount",name:n("div",{className:"whitespace-normal",innerHTML:"Total PR Amount"}),width:"140px",formatter:t=>n("div",{innerHTML:t})},{id:"total_amount",name:n("div",{className:"whitespace-normal",innerHTML:"Total PO Amount"}),width:"130px",formatter:t=>n("div",{innerHTML:t})},{id:"total_cost_saving",name:n("div",{className:"whitespace-normal",innerHTML:"Total Cost Saving"}),width:"140px",formatter:t=>n("div",{innerHTML:t})},{id:"approved_date",name:"Approved Date",width:"120px",formatter:t=>n("div",{innerHTML:t})},{id:"created_by",name:"Created By",width:"120px",formatter:t=>n("div",{innerHTML:t})},{id:"actions",name:"Actions",width:"90px",sort:!1,formatter:t=>n("div",{innerHTML:t})}]}function f(t=!1){e.ajax({url:h("purchase-order.data",{prefix:_}),method:"GET",data:c,beforeSend:function(){t&&l("Memuat data...","info",1e3)},success:function(a){const r=a.map(o=>[o.checkbox,o.number,o.request_type,o.po_number,o.supplier,o.items_count,o.total_pr_amount,o.total_amount,o.total_cost_saving,o.approved_date,o.created_by,o.actions]);p?p.updateConfig({data:r}).forceRender():(p=new w({columns:T(),data:r,pagination:{limit:10},search:!0,sort:!0}),p.render(document.querySelector("#table-po"))),e("#data-count").text(a.length),setTimeout(()=>{y("[data-plugin='tippy']",{arrow:!0,animation:"scale"}),C()},300),t&&l("Data berhasil direfresh","success",1500)},error:function(){t&&l("Gagal memuat data","error",2e3)}})}function C(){e(document).off("change","#headerCheck").on("change","#headerCheck",function(){const t=e(this).prop("checked");e(".form-checkbox").not("#headerCheck").prop("checked",t),v()}),e(document).off("change",".form-checkbox").on("change",".form-checkbox",function(){if(!e(this).is("#headerCheck")){v();const t=e(".form-checkbox").not("#headerCheck").length,a=e(".form-checkbox:checked").not("#headerCheck").length;e("#headerCheck").prop("checked",t===a)}})}function v(){const t=e(".form-checkbox:checked").not("#headerCheck").length,a=e("#btn-delete-selected");t>1?a.removeClass("hidden").prop("disabled",!1):a.addClass("hidden").prop("disabled",!0)}function O(){_=e("[data-prefix]").data("prefix")||window.__PO_PREFIX__||"",e("#table-po").length&&f(!1)}function L(){e(document).off("click","#btn-refresh").on("click","#btn-refresh",function(){f(!0)})}function H(){e(document).off("click",".btn-edit-po").on("click",".btn-edit-po",function(){const t=e(this).data("id"),a=h("purchase-order.edit",{prefix:_,purchase_order:t});window.location.href=a})}function A(){e(document).off("click","#btn-toggle-filter").on("click","#btn-toggle-filter",function(){e("#filter-section").toggleClass("hidden")}),e(document).off("click","#btn-apply-filter").on("click","#btn-apply-filter",function(){c={po_number:e("#filter-po-number").val(),item_desc:e("#filter-item-desc").val(),pr_number:e("#filter-pr-number").val(),supplier_id:e("#filter-supplier").val(),request_type:e("#filter-request-type").val(),location_id:e("#filter-location").val(),current_stage:e("#filter-stage").val(),classification_id:e("#filter-classification").val(),date_from:e("#filter-date-from").val(),date_to:e("#filter-date-to").val()},Object.keys(c).forEach(t=>{c[t]||delete c[t]}),f(!0)}),e(document).off("click","#btn-clear-filter").on("click","#btn-clear-filter",function(){e("#filter-po-number").val(""),e("#filter-item-desc").val(""),e("#filter-pr-number").val(""),e("#filter-supplier").val(""),e("#filter-request-type").val(""),e("#filter-location").val(""),e("#filter-stage").val(""),e("#filter-classification").val(""),e("#filter-date-from").val(""),e("#filter-date-to").val(""),c={},f(!0)})}function R(){e(document).on("click","#detailPOModalClose, #detailPOModalBackdrop",function(){k()}),e(document).on("keydown",function(t){t.key==="Escape"&&k()}),e(document).on("click",".po-items-count",function(t){t.preventDefault();const a=e(this).data("po-id");a&&N(a)})}function N(t){const a=e("#detailPOModal"),r=e("#detailPOModalBackdrop"),o=e("#detailPOModalContent");a.removeClass("hidden"),a.css("opacity","1"),setTimeout(()=>{r.css("opacity","1"),o.css({transform:"scale(1)",opacity:"1"})},10),e.ajax({url:h("purchase-order.detail",{prefix:_,purchase_order:t}),method:"GET",success:function(d){D(d)},error:function(d){console.error("Error loading PO detail:",d),l("Gagal memuat detail PO","error",2e3),k()}})}function k(){const t=e("#detailPOModal"),a=e("#detailPOModalBackdrop"),r=e("#detailPOModalContent");a.css("opacity","0"),r.css({transform:"scale(0.95)",opacity:"0"}),t.css("opacity","0"),setTimeout(()=>{t.addClass("hidden")},300)}function D(t){const{po:a,items:r}=t;e("#detailPONumber").text(a.po_number),e("#detailPOApprovedDate").text(a.approved_date),e("#detailPOSupplier").text(a.supplier),e("#detailPOCreatedBy").text(a.created_by),e("#detailPOCreatedAt").text(a.created_at),e("#detailPONotes").text(a.notes);const o=document.querySelector("#detailPOItemsGrid");if(!o)return;const d=r.map((i,M)=>[M+1,i.pr_number,i.pr_location,i.pr_item_desc,i.pr_uom,i.pr_approved_date,`Rp ${i.pr_unit_price}`,i.pr_qty,`Rp ${i.pr_amount}`,`Rp ${i.po_unit_price}`,i.po_qty,`Rp ${i.po_amount}`,`Rp ${i.cost_saving}`,i.percent_cost_saving,i.target_pr_to_po,i.sla_pr_to_po,i.percent_sla]),b=[{id:"number",name:"#",width:"50px"},{id:"pr_number",name:"PR Number",width:"140px"},{id:"pr_location",name:"Location",width:"130px"},{id:"pr_item_desc",name:"Item Desc",width:"200px"},{id:"pr_uom",name:"UOM",width:"80px"},{id:"pr_approved_date",name:n("div",{className:"whitespace-normal",innerHTML:"PR Approved Date"}),width:"130px"},{id:"pr_unit_price",name:n("div",{className:"whitespace-normal",innerHTML:"PR Unit Price"}),width:"120px"},{id:"pr_qty",name:n("div",{className:"whitespace-normal",innerHTML:"PR Qty"}),width:"80px"},{id:"pr_amount",name:n("div",{className:"whitespace-normal",innerHTML:"PR Amount"}),width:"130px"},{id:"po_unit_price",name:n("div",{className:"whitespace-normal",innerHTML:"PO Unit Price"}),width:"120px"},{id:"po_qty",name:n("div",{className:"whitespace-normal",innerHTML:"PO Qty"}),width:"80px"},{id:"po_amount",name:n("div",{className:"whitespace-normal",innerHTML:"PO Amount"}),width:"130px"},{id:"cost_saving",name:n("div",{className:"whitespace-normal",innerHTML:"Cost Saving"}),width:"120px"},{id:"percent_cost_saving",name:n("div",{className:"whitespace-normal",innerHTML:"% Cost Saving"}),width:"110px"},{id:"target_pr_to_po",name:n("div",{className:"whitespace-normal",innerHTML:"SLA Target PR→PO"}),width:"100px"},{id:"sla_pr_to_po",name:n("div",{className:"whitespace-normal",innerHTML:"SLA Realisasi PR→PO"}),width:"100px"},{id:"percent_sla",name:"% SLA",width:"90px"}];u?u.updateConfig({data:d,columns:b,pagination:{limit:10},search:!0}).forceRender():(u=new w({columns:b,data:d,pagination:{limit:10},search:!0,sort:!0}),u.render(o))}let s=[],x=null;function g(t){const a=e("#deleteModal"),r=e("#deleteModalBackdrop"),o=e("#deleteModalContent");e("#deleteMessage").text(t||"Apakah Anda yakin ingin menghapus data ini?"),a.removeClass("hidden").css("opacity","1"),requestAnimationFrame(()=>{r.css("opacity","1"),o.css({transform:"scale(1)",opacity:"1"})})}function m(){const t=e("#deleteModalBackdrop"),a=e("#deleteModalContent");t.css("opacity","0"),a.css({transform:"scale(0.95)",opacity:"0"}),setTimeout(()=>{e("#deleteModal").addClass("hidden").css("opacity","0"),s=[]},300)}function E(){x=e("[data-prefix]").data("prefix")||"",e(document).off("click",".btn-delete-po").on("click",".btn-delete-po",function(){const t=e(this).data("id"),a=e(this).data("number");s=[t],g(`Apakah Anda yakin ingin menghapus PO "${a}"?`)}),e(document).off("click","#btn-delete-selected").on("click","#btn-delete-selected",function(){const t=e(".form-checkbox:checked").not("#headerCheck");if(!t.length){l("Pilih minimal 1 PO untuk dihapus","warning",2e3);return}s=t.map(function(){return e(this).val()}).get(),g(`Apakah Anda yakin ingin menghapus ${s.length} purchase order?`)}),e(document).off("click","#deleteModalConfirm").on("click","#deleteModalConfirm",async function(){var r;const t=e(this),a=t.text();t.prop("disabled",!0).text("Menghapus...");try{await e.ajax({url:h("purchase-order.bulkDestroy",{prefix:x}),method:"DELETE",data:{ids:s},headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content")}}),m(),l("Purchase order berhasil dihapus!","success",2e3),setTimeout(()=>window.location.reload(),500)}catch(o){P(((r=o==null?void 0:o.responseJSON)==null?void 0:r.message)||"Gagal menghapus purchase order","Gagal!")}finally{t.prop("disabled",!1).text(a)}}),e(document).off("click","#deleteModalCancel").on("click","#deleteModalCancel",m),e(document).off("click","#deleteModal").on("click","#deleteModal",function(t){e(t.target).is("#deleteModal")&&m()}),e(document).off("keydown.po-delete").on("keydown.po-delete",function(t){t.key==="Escape"&&!e("#deleteModal").hasClass("hidden")&&m()})}e(document).ready(function(){O(),L(),H(),R(),A(),E()});
