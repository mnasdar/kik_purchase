import{$ as e}from"./modal-handler-2823516c.js";import{s as P}from"./index-88056f3d.js";import{N as n}from"./nice-select2-6e0cfbe7.js";import{a as u,c as j,b as N}from"./notification-d92c8c7c.js";import"./_commonjsHelpers-725317a4.js";import"./parse-c3570fb2.js";import"./notification-5f085df9.js";let f=null,p=null,h=null;function S(t){const r=e(t),a=r.next(".nice-select");a.length&&a.remove(),r.css({opacity:"",width:"",padding:"",height:"",display:""})}function E(){const t=e("#userRole");S(t),f&&f.destroy(),typeof n<"u"&&(f=new n(t[0],{searchable:!0,placeholder:"-- Pilih Role --"}))}function A(){const t=e("#userStatus");S(t),p&&p.destroy(),typeof n<"u"&&(p=new n(t[0],{searchable:!0,placeholder:"-- Pilih Status --"}))}function B(){const t=e("#userLocation");S(t),h&&h.destroy(),typeof n<"u"&&(h=new n(t[0],{searchable:!0,placeholder:"-- Pilih Location --"}))}function F(){e("#form-user")[0].reset(),e("#userId").val(""),e("#userMethod").val("POST");const t=e("#userPassword").closest(".space-y-2"),r=e("#userPasswordConfirmation").closest(".space-y-2");t.removeClass("hidden"),r.removeClass("hidden"),t.find("label span.text-red-500").show(),r.find("label span.text-red-500").show(),e("p[id^='error-']").text("")}function _(){const t=e("#userModal"),r=e("#userModalBackdrop"),a=e("#userModalContent");r.css("opacity","0"),a.css({transform:"scale(0.95)",opacity:"0"}),setTimeout(()=>{t.addClass("hidden").removeClass("flex").css("opacity","0")},300)}e("#btn-create-user").on("click",async function(){F(),e("#userModalTitle").text("Tambah User"),e("#userModalIcon").removeClass("mgc_user_edit_line").addClass("mgc_user_add_line"),e("#userMethod").val("POST");const t=e("#userModal"),r=e("#userModalBackdrop"),a=e("#userModalContent");t.removeClass("hidden").addClass("flex").css("opacity","1"),requestAnimationFrame(()=>{r.css("opacity","1"),a.css({transform:"scale(1)",opacity:"1"})}),e("#userLocation").val(""),h&&h.update(),e("#userRole").val(""),f&&f.update(),e("#userStatus").val(""),p&&p.update()});e("#form-user").on("submit",async function(t){if(t.preventDefault(),!!e("#userId").val())return;const v=P("users.store"),s=new FormData(this),c=e(this).find('button[type="submit"]'),O=c.html();e("p[id^='error-']").text("");const C=s.get("name");if(!C||C.trim()===""){e("#error-name").html('<i class="mgc_info_line mr-1"></i>Nama user wajib diisi');return}const x=s.get("email");if(!x||x.trim()===""){e("#error-email").html('<i class="mgc_info_line mr-1"></i>Email wajib diisi');return}const g=s.get("password"),w=s.get("password_confirmation");if(!g||g.trim()===""){e("#error-password").html('<i class="mgc_info_line mr-1"></i>Password wajib diisi');return}if(g.length<8){e("#error-password").html('<i class="mgc_info_line mr-1"></i>Password minimal 8 karakter');return}if(!w||w.trim()===""){e("#error-password_confirmation").html('<i class="mgc_info_line mr-1"></i>Konfirmasi password wajib diisi');return}if(g!==w){e("#error-password_confirmation").html('<i class="mgc_info_line mr-1"></i>Password tidak sesuai dengan konfirmasi');return}const M=s.get("role");if(!M||M.trim()===""){e("#error-role").html('<i class="mgc_info_line mr-1"></i>Role wajib dipilih');return}const T=s.get("is_active");if(!T||T.trim()===""){e("#error-is_active").html('<i class="mgc_info_line mr-1"></i>Status wajib dipilih');return}c.prop("disabled",!0),c.html('<i class="mgc_loading_line animate-spin mr-2"></i>Menyimpan...');try{const l=await fetch(v,{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},body:s}),k=await l.text();let o={};try{o=k?JSON.parse(k):{}}catch(d){console.error("Failed to parse JSON response",d,k),u("Respon server tidak valid. Silakan coba lagi.");return}if(l.status===409&&o.restorable){if(!await j(o.message||"User dengan email ini pernah dihapus. Aktifkan kembali?","Aktifkan User?",{confirmButtonText:"Ya, aktifkan",cancelButtonText:"Batal",icon:"question"}))return;s.append("restore_deleted","1");const m=await fetch(v,{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},body:s}),y=await m.text();let i={};try{i=y?JSON.parse(y):{}}catch(b){console.error("Failed to parse restore JSON response",b,y),u("Respon server tidak valid. Silakan coba lagi.");return}if(!m.ok){i.errors?Object.keys(i.errors).forEach(b=>{const R=e(`#error-${b}`);R.length&&R.text(i.errors[b][0])}):u(i.message||"Gagal mengaktifkan user");return}N(i.message||"User berhasil diaktifkan kembali","Berhasil!").then(()=>{_(),location.reload()});return}if(!l.ok){o.errors?Object.keys(o.errors).forEach(d=>{const m=e(`#error-${d}`);m.length&&m.html(`<i class="mgc_alert_circle_line mr-1"></i>${o.errors[d][0]}`)}):u(o.message||"Gagal menyimpan user");return}N(o.message||"User berhasil ditambahkan","Berhasil!").then(()=>{_(),location.reload()})}catch(l){console.error("Error:",l),u("Terjadi kesalahan saat menyimpan user")}finally{c.prop("disabled",!1),c.html(O)}});e("#userModalClose, #userModalCancel").on("click",function(){_()});e(document).ready(function(){E(),A(),B()});
