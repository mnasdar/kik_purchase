import{$ as r}from"./modal-handler-2823516c.js";import{s as k}from"./index-88056f3d.js";import{f as F}from"./index-a4e39586.js";import{A as p}from"./apexcharts.common-1a21294f.js";import{s as S,a as _}from"./notification-d92c8c7c.js";import"./_commonjsHelpers-725317a4.js";import"./parse-c3570fb2.js";import"./notification-5f085df9.js";let v=null,h=null,m=null,l=null,c=null,d=null,i={start:null,end:null},s={dateType:"pr",locationId:null,poAnalyticsType:"po"};function B(){const t=new Date,o=new Date(t);o.setFullYear(t.getFullYear()-1),v=F("#dateRange",{mode:"range",dateFormat:"d M Y",defaultDate:[o,t],allowInput:!0,onChange:function(a){a.length===2&&(i.start=a[0],i.end=a[1],g())},locale:{firstDayOfWeek:1,weekdays:{shorthand:["Min","Sen","Sel","Rab","Kam","Jum","Sab"],longhand:["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"]},months:{shorthand:["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"],longhand:["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"]}}});const e=v.selectedDates;e.length===2&&(i.start=e[0],i.end=e[1])}function g(t=!1){const o={};i.start&&(o.start_date=b(i.start)),i.end&&(o.end_date=b(i.end)),s.dateType&&(o.date_type=s.dateType),s.locationId&&(o.location_id=s.locationId),r.ajax({url:k("dashboard.data"),method:"GET",data:o,beforeSend:function(){t&&S("Memuat data dashboard...","info",1500)},success:function(e){C(e.statistics),T(e.progress),$(e.recent_pr),E(e.recent_payments),P(e.chart),t&&S("Data dashboard berhasil dimuat!","success",2e3)},error:function(e){console.error("Dashboard fetch error:",e);let a="Gagal memuat data dashboard";e.responseJSON&&e.responseJSON.message?a+=": "+e.responseJSON.message:e.status===500?a+=". Terjadi kesalahan server. Silakan cek log untuk detail.":e.status===404&&(a+=". Route tidak ditemukan."),_(a,"Error!")}})}function C(t){r("#stat-pr").text(t.pr||0),r("#stat-po").text(t.po||0),r("#stat-invoice").text(t.invoice||0),r("#stat-payment").text(t.payment||0),r("#pr-badge").text("+0%"),r("#po-badge").text(t.pr>0?Math.round(t.po/t.pr*100)+"%":"0%"),r("#invoice-badge").text(t.po>0?Math.round(t.invoice/t.po*100)+"%":"0%"),r("#payment-badge").text(t.invoice>0?Math.round(t.payment/t.invoice*100)+"%":"0%")}function T(t){r("#progress-pr-po").text(t.pr_to_po.percent+"%"),r("#bar-pr-po").css("width",t.pr_to_po.percent+"%"),r("#count-pr-po").text(`${t.pr_to_po.count} dari ${t.pr_to_po.total}`),r("#progress-po-invoice").text(t.po_to_invoice.percent+"%"),r("#bar-po-invoice").css("width",t.po_to_invoice.percent+"%"),r("#count-po-invoice").text(`${t.po_to_invoice.count} dari ${t.po_to_invoice.total}`),r("#progress-invoice-payment").text(t.invoice_to_payment.percent+"%"),r("#bar-invoice-payment").css("width",t.invoice_to_payment.percent+"%"),r("#count-invoice-payment").text(`${t.invoice_to_payment.count} dari ${t.invoice_to_payment.total}`),r("#progress-overall").text(t.overall.percent+"%"),r("#bar-overall").css("width",t.overall.percent+"%")}function $(t){const o=r("#recent-pr-list");if(t.length===0){o.html(`
            <div class="text-center py-8 text-gray-500">
                <i class="mgc_inbox_line text-3xl"></i>
                <p class="mt-2">Tidak ada data PR dalam periode ini</p>
            </div>
        `);return}const e=t.map(a=>`
        <div class="flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
            <div class="flex-1">
                <p class="font-semibold text-sm text-gray-800 dark:text-white">${a.pr_number}</p>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                    <i class="mgc_location_line"></i> ${a.location} • ${a.created_at}
                </p>
            </div>
            <div class="text-right">
                <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${R(a.status)}">
                    ${a.status}
                </span>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">${a.created_by}</p>
            </div>
        </div>
    `).join("");o.html(e)}function E(t){const o=r("#recent-payment-list");if(t.length===0){o.html(`
            <div class="text-center py-8 text-gray-500">
                <i class="mgc_inbox_line text-3xl"></i>
                <p class="mt-2">Tidak ada data payment dalam periode ini</p>
            </div>
        `);return}const e=t.map(a=>`
        <div class="flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
            <div class="flex-1">
                <p class="font-semibold text-sm text-gray-800 dark:text-white">${a.payment_number}</p>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                    <i class="mgc_file_line"></i> ${a.invoice_number} • ${a.payment_date}
                </p>
            </div>
            <div class="text-right">
                <span class="inline-block px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300">
                    Paid
                </span>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">${a.created_by}</p>
            </div>
        </div>
    `).join("");o.html(e)}function P(t){h&&h.destroy();const o={series:t.series,chart:{type:"line",height:350,toolbar:{show:!0,tools:{download:!0,selection:!1,zoom:!1,zoomin:!1,zoomout:!1,pan:!1,reset:!1}},animations:{enabled:!0,easing:"easeinout",speed:800}},colors:["#3B82F6","#8B5CF6","#F59E0B","#10B981"],stroke:{width:3,curve:"smooth"},markers:{size:5,hover:{size:7}},xaxis:{categories:t.categories,labels:{style:{colors:"#64748B"}}},yaxis:{labels:{style:{colors:"#64748B"}}},legend:{position:"top",horizontalAlign:"right",labels:{colors:"#64748B"}},grid:{borderColor:"#E5E7EB",strokeDashArray:4},tooltip:{theme:"light",x:{show:!0},y:{formatter:function(e){return e+" items"}}}};h=new p(document.querySelector("#chart-purchasing"),o),h.render()}function R(t){return{Pending:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300",Approved:"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300",Rejected:"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300",Completed:"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300"}[t]||"bg-gray-100 text-gray-700 dark:bg-gray-900 dark:text-gray-300"}function b(t){const o=t.getFullYear(),e=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${o}-${e}-${a}`}function D(){const t=new Date,o=new Date(t);o.setFullYear(t.getFullYear()-1),v.setDate([o,t]),i.start=o,i.end=t,r("#dateTypeFilter").val("pr").trigger("change");const e=r("#unitFilter");e.is("select")&&e.val("").trigger("change"),s.dateType="pr",s.locationId=null,g(!0),f(),y()}function f(){const t={},o=s.poAnalyticsType||"po";s.locationId&&(t.location_id=s.locationId);const e=o==="pr"?"dashboard.pr-analytics":"dashboard.po-analytics";r.ajax({url:k(e),method:"GET",data:t,success:function(a){z(a,o)},error:function(a){console.error("Analytics fetch error:",a),_("Gagal memuat data analisis","Error!")}})}function y(){const t={};i.start&&(t.start_date=b(i.start)),i.end&&(t.end_date=b(i.end));const o=r("#unitFilter");let e=null;o.is("select"),e=o.val()||null,e&&(t.location_id=e),r.ajax({url:k("dashboard.cost-saving"),method:"GET",data:t,success:function(a){I(a)},error:function(a){console.error("Cost Saving fetch error:",a.responseJSON||a.statusText),l&&(l.destroy(),l=null),c&&(c.destroy(),c=null),d&&(d.destroy(),d=null),r("#chart-cost-saving-total").html('<div class="text-center py-8 text-gray-500"><i class="mgc_inbox_2_line text-3xl"></i><p class="mt-2">Tidak ada data</p></div>'),r("#chart-cost-saving-percent").html('<div class="text-center py-8 text-gray-500"><i class="mgc_inbox_2_line text-3xl"></i><p class="mt-2">Tidak ada data</p></div>'),r("#chart-sla-percent").html('<div class="text-center py-8 text-gray-500"><i class="mgc_inbox_2_line text-3xl"></i><p class="mt-2">Tidak ada data</p></div>')}})}function I(t){if(l&&l.destroy(),c&&c.destroy(),d&&d.destroy(),(t.mode||"aggregated")==="per-location"){const e={series:t.seriesTotal,chart:{type:"bar",height:380,toolbar:{show:!0}},plotOptions:{bar:{borderRadius:4,columnWidth:"70%",dataLabels:{position:"top"}}},colors:["#10B981","#3B82F6","#8B5CF6","#F59E0B","#EF4444","#EC4899","#14B8A6","#F97316"],xaxis:{categories:t.categories,labels:{style:{colors:"#64748B"},rotate:-45,rotateAlways:t.categories.length>20}},yaxis:{title:{text:"Total Cost Saving (Rp)",style:{color:"#64748B"}},labels:{formatter:n=>"Rp "+Math.round(n).toLocaleString("id-ID"),style:{colors:"#64748B"}}},dataLabels:{enabled:!1},legend:{position:"top",horizontalAlign:"center",fontSize:"12px",markers:{width:10,height:10,radius:2}},tooltip:{shared:!0,intersect:!1,y:{formatter:function(n){return`Rp ${Math.round(n).toLocaleString("id-ID")}`}}},grid:{borderColor:"#E5E7EB",strokeDashArray:4}};l=new p(document.querySelector("#chart-cost-saving-total"),e),l.render();const a={series:t.seriesPercent,chart:{type:"line",height:380,toolbar:{show:!0}},stroke:{width:3,curve:"smooth"},markers:{size:4},colors:["#10B981","#3B82F6","#8B5CF6","#F59E0B","#EF4444","#EC4899","#14B8A6","#F97316"],xaxis:{categories:t.categories,labels:{style:{colors:"#64748B"},rotate:-45,rotateAlways:t.categories.length>20}},yaxis:{title:{text:"Percentage (%)",style:{color:"#64748B"}},labels:{formatter:n=>`${n}%`,style:{colors:"#64748B"}},min:0,max:100},legend:{position:"top",horizontalAlign:"center",fontSize:"11px",markers:{width:10,height:10,radius:12}},tooltip:{shared:!0,intersect:!1,y:{formatter:function(n){return`${n}%`}}},grid:{borderColor:"#E5E7EB",strokeDashArray:4}};c=new p(document.querySelector("#chart-cost-saving-percent"),a),c.render();const u={series:t.seriesSla,chart:{type:"line",height:380,toolbar:{show:!0}},stroke:{width:3,curve:"smooth"},markers:{size:4},colors:["#10B981","#3B82F6","#8B5CF6","#F59E0B","#EF4444","#EC4899","#14B8A6","#F97316"],xaxis:{categories:t.categories,labels:{style:{colors:"#64748B"},rotate:-45,rotateAlways:t.categories.length>20}},yaxis:{title:{text:"Percentage (%)",style:{color:"#64748B"}},labels:{formatter:n=>`${n}%`,style:{colors:"#64748B"}},min:0,max:100},legend:{position:"top",horizontalAlign:"center",fontSize:"11px",markers:{width:10,height:10,radius:12}},tooltip:{shared:!0,intersect:!1,y:{formatter:function(n){return`${n}%`}}},grid:{borderColor:"#E5E7EB",strokeDashArray:4}};d=new p(document.querySelector("#chart-sla-percent"),u),d.render()}else{const e={series:[t.series[0]],chart:{type:"bar",height:380,toolbar:{show:!0}},plotOptions:{bar:{borderRadius:4,columnWidth:"60%"}},colors:["#10B981"],xaxis:{categories:t.categories,labels:{style:{colors:"#64748B"},rotate:-45,rotateAlways:t.categories.length>20}},yaxis:{title:{text:"Total Cost Saving (Rp)",style:{color:"#10B981"}},labels:{formatter:n=>"Rp "+Math.round(n).toLocaleString("id-ID"),style:{colors:"#64748B"}}},dataLabels:{enabled:!1},legend:{position:"top",horizontalAlign:"center"},tooltip:{y:{formatter:function(n){return`Rp ${Math.round(n).toLocaleString("id-ID")}`}}},grid:{borderColor:"#E5E7EB",strokeDashArray:4}};l=new p(document.querySelector("#chart-cost-saving-total"),e),l.render();const a={series:[t.series[1]],chart:{type:"line",height:380,toolbar:{show:!0}},stroke:{width:3,curve:"smooth"},markers:{size:5},colors:["#F59E0B"],xaxis:{categories:t.categories,labels:{style:{colors:"#64748B"},rotate:-45,rotateAlways:t.categories.length>20}},yaxis:{title:{text:"Percentage (%)",style:{color:"#64748B"}},labels:{formatter:n=>`${n}%`,style:{colors:"#64748B"}},min:0,max:100},legend:{position:"top",horizontalAlign:"center"},tooltip:{shared:!0,intersect:!1,y:{formatter:function(n){return`${n}%`}}},grid:{borderColor:"#E5E7EB",strokeDashArray:4}};c=new p(document.querySelector("#chart-cost-saving-percent"),a),c.render();const u={series:[t.series[2]],chart:{type:"line",height:380,toolbar:{show:!0}},stroke:{width:3,curve:"smooth"},markers:{size:5},colors:["#EF4444"],xaxis:{categories:t.categories,labels:{style:{colors:"#64748B"},rotate:-45,rotateAlways:t.categories.length>20}},yaxis:{title:{text:"Percentage (%)",style:{color:"#64748B"}},labels:{formatter:n=>`${n}%`,style:{colors:"#64748B"}},min:0,max:100},legend:{position:"top",horizontalAlign:"center"},tooltip:{shared:!0,intersect:!1,y:{formatter:function(n){return`${n}%`}}},grid:{borderColor:"#E5E7EB",strokeDashArray:4}};d=new p(document.querySelector("#chart-sla-percent"),u),d.render()}}function z(t,o="po"){m&&m.destroy();const e=o==="pr"?"Jumlah PR Items":"Jumlah PO Items",a=o==="pr"?"items PR":"items PO",u={chart:{height:400,type:"line",stacked:!1,toolbar:{show:!0,tools:{download:!0,zoom:!0,zoomin:!0,zoomout:!0,pan:!0,reset:!0}},animations:{enabled:!0,easing:"easeinout",speed:800}},stroke:{width:[0,3,3],curve:"smooth"},plotOptions:{bar:{columnWidth:"50%"}},colors:["#3b82f6","#8b5cf6","#10b981"],series:t.series,fill:{opacity:[.85,1,1],gradient:{inverseColors:!1,shade:"light",type:"vertical",opacityFrom:.85,opacityTo:.55,stops:[0,100]}},labels:t.categories,markers:{size:[0,4,4],strokeWidth:2,hover:{size:6}},xaxis:{type:"category",labels:{rotate:-45,rotateAlways:!0,style:{fontSize:"11px"}}},yaxis:[{title:{text:"Total Amount (Juta Rupiah)",style:{color:"#3b82f6"}},labels:{formatter:function(n){return"Rp "+n.toFixed(1)+" Jt"},style:{colors:"#3b82f6"}}},{opposite:!0,title:{text:e,style:{color:"#8b5cf6"}},labels:{formatter:function(n){return Math.round(n)+" items"},style:{colors:"#8b5cf6"}}},{opposite:!0,title:{text:"Avg SLA Realisasi (%)",style:{color:"#10b981"}},labels:{formatter:function(n){return n.toFixed(1)+"%"},style:{colors:"#10b981"}},min:0,max:100}],tooltip:{shared:!0,intersect:!1,y:[{formatter:function(n){return"Rp "+n.toFixed(2)+" Juta"}},{formatter:function(n){return Math.round(n)+" "+a}},{formatter:function(n){return n.toFixed(1)+"% (Avg SLA)"}}]},legend:{position:"top",horizontalAlign:"center",offsetY:0,markers:{width:12,height:12,radius:3}},grid:{borderColor:"#f1f1f1",strokeDashArray:3,padding:{top:0,right:30,bottom:0,left:10}}};m=new p(document.querySelector("#chart-po-analytics"),u),m.render()}r(document).ready(function(){B();const t=r("#unitFilter"),o=t.val();o&&(s.locationId=o),w(),g(!1),f(),y(),r("#btn-reset-filter").on("click",function(){D()}),r("#dateTypeFilter").on("change",function(){s.dateType=r(this).val(),g(!0)}),t.is("select")&&!t.is(":disabled")&&t.on("change",function(){s.locationId=r(this).val()||null,w(),g(!0),f(),y()}),r(document).off("change","#costSavingLocation").on("change","#costSavingLocation",function(){y()}),r("#poAnalyticsFilter").on("change",function(){s.poAnalyticsType=r(this).val(),A(),f()})});function x(){const t=r("#unitFilter"),o=t.val();return o&&o!==""?t.find("option:selected").text():null}function w(){M(),J(),A(),L()}function M(){const t=x(),o=r("#progressFlowTitle");let e="Progress Flow";t&&(e=`Progress Flow <span class="text-indigo-600 dark:text-indigo-400 font-semibold">- ${t}</span>`),o.html(e)}function J(){const t=x(),o=r("#chartItemTitle");let e="Grafik Jumlah Item";t&&(e=`Grafik Jumlah Item <span class="text-purple-600 dark:text-purple-400 font-semibold">- ${t}</span>`),o.html(e)}function A(){const t=s.poAnalyticsType||"po",o=x(),e={po:{title:"Grafik Purchase Order (PO)",subtitle:"Grafik total amount, jumlah PO, dan rata-rata % realisasi SLA per bulan (12 bulan terakhir)"},pr:{title:"Grafik Purchase Request (PR)",subtitle:"Grafik total amount, jumlah PR, dan rata-rata % realisasi SLA per bulan (12 bulan terakhir)"}},a=e[t]||e.po,u=r("#poChartTitle");let n=a.title;o&&(n=`${a.title} <span class="text-purple-600 dark:text-purple-400 font-semibold">- ${o}</span>`),u.html(n),r("#poChartSubtitle").text(a.subtitle)}function L(){const t=x();let o="Total Cost Saving";t&&(o=`Total Cost Saving <span class="text-purple-600 dark:text-purple-400 font-semibold">- ${t}</span>`),r("#totalCostSavingTitle").html(o);let e="% Cost Saving";t&&(e=`% Cost Saving <span class="text-purple-600 dark:text-purple-400 font-semibold">- ${t}</span>`),r("#percentCostSavingTitle").html(e);let a="% SLA PR → PO";t&&(a=`% SLA PR → PO <span class="text-purple-600 dark:text-purple-400 font-semibold">- ${t}</span>`),r("#slaCostSavingTitle").html(a)}
