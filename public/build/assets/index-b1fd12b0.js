import{$ as t}from"./modal-handler-2823516c.js";import{i as w}from"./data-table-e496d1b5.js";import{b as m}from"./gridjs.module-3ea5c5ab.js";import{s as l}from"./index-88056f3d.js";import{t as _}from"./tippy.all-093076db.js";import{s as r,c as v,a as c}from"./notification-d92c8c7c.js";import"./_commonjsHelpers-725317a4.js";import"./parse-c3570fb2.js";import"./glightbox.min-3fffbd26.js";import"./notification-5f085df9.js";let b=[];function E(){if(!t("#table-locations").length)return;const e=[{id:"number",name:"#",width:"60px"},{id:"name",name:"Nama Unit Kerja",width:"300px",formatter:o=>m("div",{innerHTML:o})},{id:"users_count",name:"Users",width:"150px",formatter:o=>m("div",{innerHTML:o})},{id:"purchase_requests_count",name:"Purchase Requests",width:"180px",formatter:o=>m("div",{innerHTML:o})},{id:"created_at",name:"Dibuat",width:"150px",formatter:o=>m("div",{innerHTML:o})},{id:"actions",name:"Actions",width:"120px",formatter:o=>m("div",{innerHTML:o})}],a=[{selector:"#btn-delete-selected",when:"multiple"}];w({tableId:"#table-locations",dataUrl:l("unit-kerja.data"),columns:e,enableCheckbox:!0,buttonConfig:a,limit:10,enableFilter:!1,onDataLoaded:o=>{t("#data-count").text(o.length),x()}})}function x(){b.forEach(a=>a.destroy()),b=[];const e=document.querySelectorAll('#table-locations [data-plugin="tippy"]');e.length&&(b=_(e))}function D(){const e=t("#table-locations").data("grid");e&&(r("Memuat data...","info",1e3),t.ajax({url:l("unit-kerja.data"),method:"GET",success:function(a){const o=a.map(n=>[n.checkbox,n.number,n.name,n.users_count,n.purchase_requests_count,n.created_at,n.actions]);e.updateConfig({data:o}).forceRender(),t("#data-count").text(a.length),setTimeout(()=>{x()},300),r("Data berhasil direfresh","success",1500)},error:function(a){console.error("Error loading data:",a),r("Gagal memuat data","error",2e3)}}))}function A(){t("#btn-refresh").on("click",function(){D()})}function B(){const e=t("#locationModal"),a=t("#locationModalBackdrop"),o=t("#locationModalContent");e.removeClass("hidden").css("opacity","1"),requestAnimationFrame(()=>{a.css("opacity","1"),o.css({transform:"scale(1)",opacity:"1"})})}function u(){const e=t("#locationModalBackdrop"),a=t("#locationModalContent");e.css("opacity","0"),a.css({transform:"scale(0.95)",opacity:"0"}),setTimeout(()=>{t("#locationModal").addClass("hidden").css("opacity","0"),C()},300)}function C(){t("#locationForm")[0].reset(),t("#location_id").val(""),t("#form_method").val("POST"),t("[id^='error-']").addClass("hidden").text(""),t("#locationForm input, #locationForm select, #locationForm textarea").removeClass("border-red-500")}function T(e){t('[id^="error-"]').addClass("hidden").text(""),t("#locationForm input, #locationForm select, #locationForm textarea").removeClass("border-red-500");for(const[o,n]of Object.entries(e)){const s=t(`#error-${o}`),i=t(`[name="${o}"]`);s.length&&(s.removeClass("hidden").text(n[0]),i.addClass("border-red-500"))}const a=t("#locationForm .border-red-500").first();a.length&&a.focus()}function S(){t("#locationForm").on("submit",function(e){e.preventDefault(),t("#locationFormSubmit").trigger("click")})}function G(){t("#btn-create-location").on("click",function(){C(),t("#locationModalTitle").text("Tambah Unit Kerja"),t("#locationModalIcon").removeClass("mgc_edit_line").addClass("mgc_location_line"),t("#submitButtonText").text("Simpan"),r("Form siap untuk diisi","info",1500),B()})}function U(){t("#locationFormSubmit").on("click",async function(){const e=t(this),a=t("#submitButtonText").text();if(t("#form_method").val()!=="PUT"){e.prop("disabled",!0),t("#submitButtonText").html('<i class="mgc_loading_line animate-spin mr-2"></i>Menyimpan...');try{const n=new FormData(t("#locationForm")[0]),s=await fetch(l("unit-kerja.store"),{method:"POST",headers:{"X-CSRF-TOKEN":t('meta[name="csrf-token"]').attr("content"),Accept:"application/json"},body:n}),i=await s.json();if(s.ok)u(),r("Unit kerja berhasil ditambahkan!","success",2e3),setTimeout(()=>location.reload(),500);else if(s.status===409&&i.status==="soft-deleted"){const d=t("#name").val();if(!await v(`Data "${d}" sudah pernah ditambahkan dan dinonaktifkan. Aktifkan kembali?`,"Aktifkan data?")){r("Data tidak diaktifkan. Anda tetap di form ini.","info",2e3);return}const h=new FormData(t("#locationForm")[0]);h.append("reactivate","1"),h.append("reactivate_id",i.id);const M=await fetch(l("unit-kerja.store"),{method:"POST",headers:{"X-CSRF-TOKEN":t('meta[name="csrf-token"]').attr("content"),Accept:"application/json"},body:h}),k=await M.json();M.ok?(u(),r("Unit kerja diaktifkan kembali dan diperbarui!","success",2e3),setTimeout(()=>location.reload(),500)):k.errors?(T(k.errors),r("Mohon periksa kembali data yang Anda masukkan","error",3e3)):c(k.message||"Terjadi kesalahan saat menyimpan data","Gagal!")}else i.errors?(T(i.errors),r("Mohon periksa kembali data yang Anda masukkan","error",3e3)):c(i.message||"Terjadi kesalahan saat menyimpan data","Gagal!")}catch(n){c("Gagal menyimpan data unit kerja","Gagal!"),console.error(n)}finally{e.prop("disabled",!1),t("#submitButtonText").text(a)}}})}function $(){t("#locationModalClose, #locationModalCancel").on("click",u),t("#locationModal").on("click",function(e){e.target===this&&u()}),t(document).on("keydown",function(e){e.key==="Escape"&&(t("#locationModal").hasClass("hidden")||u())})}let j=null;function L(){const e=t("#locationModal"),a=t("#locationModalBackdrop"),o=t("#locationModalContent");e.removeClass("hidden").css("opacity","1"),requestAnimationFrame(()=>{a.css("opacity","1"),o.css({transform:"scale(1)",opacity:"1"})})}function O(){const e=t("#locationModalBackdrop"),a=t("#locationModalContent");e.css("opacity","0"),a.css({transform:"scale(0.95)",opacity:"0"}),setTimeout(()=>{t("#locationModal").addClass("hidden").css("opacity","0")},300)}function P(e){t('[id^="error-"]').addClass("hidden").text(""),t("#locationForm input, #locationForm select, #locationForm textarea").removeClass("border-red-500");for(const[o,n]of Object.entries(e)){const s=t(`#error-${o}`),i=t(`[name="${o}"]`);s.length&&(s.removeClass("hidden").text(n[0]),i.addClass("border-red-500"))}const a=t("#locationForm .border-red-500").first();a.length&&a.focus()}function R(){t(document).on("click",".btn-edit-location",async function(){const e=t(this).data("id");j=e;try{const o=await(await fetch(l("unit-kerja.show",{unit_kerja:e}))).json();t("#location_id").val(o.id),t("#form_method").val("PUT"),t("#name").val(o.name),t("#locationModalTitle").text("Edit Unit Kerja"),t("#locationModalIcon").removeClass("mgc_location_line").addClass("mgc_edit_line"),t("#submitButtonText").text("Update"),L()}catch(a){c("Gagal mengambil data unit kerja","Gagal!"),console.error(a)}})}function q(){t("#locationFormSubmit").on("click",async function(){const e=t(this),a=t("#submitButtonText").text();if(t("#form_method").val()==="PUT"){e.prop("disabled",!0),t("#submitButtonText").html('<i class="mgc_loading_line animate-spin mr-2"></i>Menyimpan...');try{const n=new FormData(t("#locationForm")[0]),s=await fetch(l("unit-kerja.update",{unit_kerja:j}),{method:"POST",headers:{"X-CSRF-TOKEN":t('meta[name="csrf-token"]').attr("content"),Accept:"application/json"},body:n}),i=await s.json();s.ok?(O(),r("Unit kerja berhasil diperbarui!","success",2e3),setTimeout(()=>location.reload(),500)):i.errors?(P(i.errors),r("Mohon periksa kembali data yang Anda masukkan","error",3e3)):c(i.message||"Terjadi kesalahan saat menyimpan data","Gagal!")}catch(n){c("Gagal menyimpan data unit kerja","Gagal!"),console.error(n)}finally{e.prop("disabled",!1),t("#submitButtonText").text(a)}}})}let g=null,p="single";function F(){const e=t("#deleteModal"),a=t("#deleteModalBackdrop"),o=t("#deleteModalContent");e.removeClass("hidden").css("opacity","1"),requestAnimationFrame(()=>{a.css("opacity","1"),o.css({transform:"scale(1)",opacity:"1"})})}function f(){const e=t("#deleteModalBackdrop"),a=t("#deleteModalContent");e.css("opacity","0"),a.css({transform:"scale(0.95)",opacity:"0"}),setTimeout(()=>{t("#deleteModal").addClass("hidden").css("opacity","0")},300)}function I(){t(document).on("click",".btn-delete-location",function(){g=t(this).data("id");const e=t(this).data("name");p="single",t("#deleteMessage").text(`Apakah Anda yakin ingin menghapus unit kerja "${e}"?`),F()})}function K(){t("#btn-delete-selected").on("click",function(){const a=t("#table-locations input[type='checkbox']:checked:not(.select-all)").length;if(a===0){r("Pilih unit kerja yang ingin dihapus","warning",2e3);return}p="bulk",t("#deleteMessage").text(`Apakah Anda yakin ingin menghapus ${a} unit kerja yang dipilih?`),F()})}function H(){t("#deleteModalConfirm").on("click",async function(){const e=t(this);e.prop("disabled",!0).html('<i class="mgc_loading_line animate-spin mr-2"></i>Menghapus...');try{let a,o;if(p==="single")a=l("unit-kerja.destroy",{unit_kerja:g}),o=new FormData,o.append("_method","DELETE");else{const d=t("#table-locations input[type='checkbox']:checked:not(.select-all)").map(function(){return t(this).val()}).get();a=l("unit-kerja.bulkDestroy"),o=new FormData,o.append("_method","DELETE"),d.forEach(y=>o.append("ids[]",y))}const n=await fetch(a,{method:"POST",headers:{"X-CSRF-TOKEN":t('meta[name="csrf-token"]').attr("content"),Accept:"application/json"},body:o}),s=await n.json();if(n.ok){f();const i=p==="single"?[g]:t("#table-locations input[type='checkbox']:checked:not(.select-all)").map(function(){return t(this).val()}).get(),d=p==="single"?"Unit kerja berhasil dihapus!":`${i.length} unit kerja berhasil dihapus!`;r(d,"success",2e3),setTimeout(()=>location.reload(),500)}else c(s.message||"Gagal menghapus unit kerja","Gagal!")}catch(a){c("Gagal menghapus unit kerja","Gagal!"),console.error(a)}finally{e.prop("disabled",!1).text("Hapus")}})}function N(){t("#deleteModalCancel").on("click",f),t("#deleteModal").on("click",function(e){e.target===this&&f()}),t(document).on("keydown",function(e){e.key==="Escape"&&(t("#deleteModal").hasClass("hidden")||f())})}t(document).ready(function(){E(),A(),G(),U(),S(),$(),R(),q(),I(),K(),H(),N()});
