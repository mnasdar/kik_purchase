import{$ as t}from"./jquery-2823516c.js";import{K as T,b as i,a as B}from"./gridjs.module-3ea5c5ab.js";import{s as f}from"./index-88056f3d.js";import{S as s}from"./sweetalert2.all-5f085df9.js";import"./_commonjsHelpers-725317a4.js";import"./parse-c3570fb2.js";const c="#show_pr-table",C="#purchase_order-table",g=t(".btn-savepr"),b=t(".btn-deletepr"),P=window.location.pathname,S=P.split("/"),x=S[1];let k=null;t("[modal-close]").on("click",()=>{t(c).empty()});t(document).on("click",".btn-showpr",function(){const r=t(this).data("id");k=r,g.hide(),b.show(),M(r),t(".btn-show").trigger("click")});t(document).on("click",".btn-linktopr",function(){const r=`headerCheck-${C.replace("#","")}`,a=t(`${C} input[type="checkbox"]:not(#${r}):checked`);k=a.length===1?a.val():null,g.show(),b.hide(),L()});g.off("click").on("click",function(){const r=`headerCheck-${c.replace("#","")}`,a=t(`${c} input[type="checkbox"]:not(#${r}):checked`);if(a.length===0)return s.fire({icon:"warning",title:"Perhatian!",text:"Pilih minimal satu data PR.",confirmButtonText:"OK",customClass:{confirmButton:"btn bg-primary text-white w-xs mt-2"},buttonsStyling:!1});const o=a.map(function(){return t(this).val()}).get();s.fire({title:"Anda yakin?",text:`Simpan ${o.length} PR ke PO terpilih?`,icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Simpan",cancelButtonText:"Batal",customClass:{confirmButton:"btn bg-success text-white w-xs",cancelButton:"btn bg-secondary text-white w-xs ms-2"},buttonsStyling:!1}).then(e=>{e.isConfirmed&&t.ajax({url:f("purchase-tracking.store",x),method:"POST",headers:{"X-CSRF-TOKEN":t('meta[name="csrf-token"]').attr("content")},contentType:"application/json",data:JSON.stringify({po_id:k,ids:o}),success:()=>{s.fire("Berhasil!","Data berhasil disimpan.","success").then(()=>location.reload())},error:()=>{s.fire("Gagal!","Terjadi kesalahan saat menyimpan data.","error")}})})});b.off("click").on("click",function(){const r=`headerCheck-${c.replace("#","")}`,a=t(`${c} input[type="checkbox"]:not(#${r}):checked`);if(a.length===0)return s.fire({icon:"warning",title:"Perhatian!",text:"Pilih minimal satu data PR.",confirmButtonText:"OK",customClass:{confirmButton:"btn bg-primary text-white w-xs mt-2"},buttonsStyling:!1});const o=a.map(function(){return t(this).val()}).get();s.fire({title:"Anda yakin?",text:`Hapus ${o.length} PR ke PO terpilih?`,icon:"question",showCancelButton:!0,confirmButtonText:"Ya, Simpan",cancelButtonText:"Batal",customClass:{confirmButton:"btn bg-success text-white w-xs",cancelButton:"btn bg-secondary text-white w-xs ms-2"},buttonsStyling:!1}).then(e=>{e.isConfirmed&&t.ajax({url:f("purchase-tracking.bulkDestroy",x),method:"Delete",headers:{"X-CSRF-TOKEN":t('meta[name="csrf-token"]').attr("content")},contentType:"application/json",data:JSON.stringify({po_id:k,pr_id:o}),success:()=>{s.fire("Berhasil!","Data berhasil dihapus.","success").then(()=>location.reload())},error:()=>{s.fire("Gagal!","Terjadi kesalahan saat menghapus data.","error")}})})});function L(){t.getJSON(f("purchase-order.showpr",x),function(r){if(!r.length)return t(c).html('<p class="text-center py-4 text-gray-400">Data tidak ditemukan.</p>');const a=`headerCheck-${c.replace("#","")}`;v({gridData:r.map(e=>[e.checkbox,e.number,e.status,e.classification,e.pr_number,e.location,e.item_desc,e.uom,e.approved_date,e.unit_price,e.qty,e.amount,e.sla]),columns:[{id:"Checkbox",name:T(`<div class="form-check"><input type="checkbox" class="form-checkbox rounded text-primary" id="${a}"></div>`),width:"50px",sort:!1,formatter:e=>i("div",{innerHTML:e})},{name:"#",width:"60px"},{name:"Status",width:"130px",formatter:e=>i("div",{innerHTML:e})},{name:"Classification",width:"200px"},{name:"PR Number",width:"200px",formatter:e=>i("div",{innerHTML:e})},{name:"Location",width:"150px"},{name:"Item Desc",width:"200px"},{name:"UOM",width:"100px"},{name:"Date",width:"120px"},{name:"Unit Price",width:"200px",formatter:e=>i("div",{innerHTML:e})},{name:"Qty",width:"90px",formatter:e=>i("div",{innerHTML:e})},{name:"Amount",width:"200px",formatter:e=>i("div",{innerHTML:e})},{name:"SLA",width:"100px",formatter:e=>i("div",{innerHTML:e})}],buttonConfig:[{selector:".btn-savepr",when:"any"}]});const o=`${c} input[type="checkbox"]`;t(document).on("change",`#${a}`,function(){const e=t(this).is(":checked");t(`${o}`).not(this).prop("checked",e).trigger("change")})}).fail(()=>{t(c).html('<p class="text-center text-red-500 py-4">Gagal memuat data.</p>')})}function M(r){t.ajax({url:f("purchase-order.show",[x,r]),method:"GET",dataType:"json",success:function(a){if(!a.length)return t(c).html('<p class="text-center py-4 text-gray-400">Data tidak ditemukan.</p>');const o=`headerCheck-${c.replace("#","")}`;v({gridData:a.map(n=>[n.checkbox,n.number,n.status,n.classification,n.pr_number,n.location,n.item_desc,n.uom,n.approved_date,n.unit_price,n.qty,n.amount,n.sla]),columns:[{id:"Checkbox",name:T(`<div class="form-check"><input type="checkbox" class="form-checkbox rounded text-primary" id="${o}"></div>`),width:"50px",sort:!1,formatter:n=>i("div",{innerHTML:n})},{name:"#",width:"60px"},{name:"Status",width:"130px",formatter:n=>i("div",{innerHTML:n})},{name:"Classification",width:"200px"},{name:"PR Number",width:"200px",formatter:n=>i("div",{innerHTML:n})},{name:"Location",width:"150px"},{name:"Item Desc",width:"200px"},{name:"UOM",width:"100px"},{name:"Date",width:"120px"},{name:"Unit Price",width:"200px",formatter:n=>i("div",{innerHTML:n})},{name:"Qty",width:"90px",formatter:n=>i("div",{innerHTML:n})},{name:"Amount",width:"200px",formatter:n=>i("div",{innerHTML:n})},{name:"SLA",width:"100px",formatter:n=>i("div",{innerHTML:n})}],buttonConfig:[{selector:".btn-deletepr",when:"any"}]});const e=`${c} input[type="checkbox"]`;t(document).on("change",`#${o}`,function(){const n=t(this).is(":checked");t(`${e}`).not(this).prop("checked",n).trigger("change")})},error:function(){t(c).html('<p class="text-center text-red-500 py-4">Gagal memuat data.</p>')}})}function v({gridData:r,columns:a,limit:o=5,delay:e=300,buttonConfig:n=[]}){const l=`headerCheck-${c.replace("#","")}`,h=document.querySelector(c);if(!h)return;for(;h.firstChild;)h.removeChild(h.firstChild);const w=document.createElement("div");w.style.overflowX="auto",h.appendChild(w),new B({columns:a,pagination:{limit:o},search:!0,sort:!0,data:()=>new Promise(d=>setTimeout(()=>d(r),200))}).render(w),setTimeout(()=>{const d=`${c} input[type="checkbox"]`;t(document).on("change",`#${l}`,function(){const p=t(this).is(":checked");t(`${d}`).not(this).prop("checked",p).trigger("change")}),t(document).on("change",`${d}:not(#${l})`,function(){const p=t(`${d}:not(#${l})`),u=p.filter(":checked");t(`#${l}`).prop("checked",p.length===u.length),n.forEach(y=>{const $=t(y.selector);if(!$.length)return;let m=!1;switch(y.when){case"one":m=u.length===1;break;case"multiple":m=u.length>1;break;case"any":m=u.length>0;break}$.prop("disabled",!m)})})},e)}
