import{$ as t}from"./jquery-2823516c.js";import{f}from"./index-a4e39586.js";import{s as h}from"./index-88056f3d.js";import{s as c}from"./notification-0e55581f.js";import"./_commonjsHelpers-725317a4.js";import"./parse-c3570fb2.js";import"./pembayaran-edit-5f085df9.js";t(document).ready(function(){t("#form-bulk-edit-onsite").length&&g()});function g(){y(),d(),b()}function y(){document.getElementById("onsite_date")&&(f("#onsite_date",{dateFormat:"Y-m-d",altInput:!0,altFormat:"d-M-y",defaultDate:t("#onsite_date").val()||null,allowInput:!0,onChange:d}),t("#onsite_date").on("change",d))}function _(i,s){if(!i||!s)return null;const o=new Date(`${i}T00:00:00`),e=new Date(`${s}T00:00:00`);if(isNaN(o.getTime())||isNaN(e.getTime())||e<o)return null;let n=0;const a=new Date(o);for(;a<=e;){const r=a.getDay();r!==0&&r!==6&&n++,a.setDate(a.getDate()+1)}return n}function d(){const i=t("#onsite_date").val();t(".sla-display").each(function(){const s=t(this).data("approved-date"),o=t(this).data("id"),e=t(this).data("initial");let n=e===""||e===null||e===void 0?"":e;if(i&&s){const r=_(s,i);r!==null&&(n=r)}const a=n===""?"-":`${n} hari`;t(this).text(a),t(`input[name="sla_realisasi[${o}]"]`).val(n)})}function b(){const i=t("#form-bulk-edit-onsite").data("ids"),s=Array.isArray(i)?i:[];t("#form-bulk-edit-onsite").on("submit",function(o){o.preventDefault();const e={};t("input[name^='sla_realisasi[']").each(function(){const u=t(this).attr("name").match(/sla_realisasi\[(\d+)\]/);if(u){const p=u[1],m=t(this).val();e[p]=m!==""?parseInt(m,10):null}});const n={ids:s,onsite_date:t("#onsite_date").val(),sla_realisasi:e};if(!n.onsite_date){c("Tanggal Onsite harus diisi","warning",2e3);return}const a=t("#btn-submit"),r=a.html();a.prop("disabled",!0).html('<i class="mgc_spinner_2_line animate-spin mr-2"></i>Menyimpan...'),t.ajax({url:h("po-onsite.bulk-update"),method:"POST",data:JSON.stringify(n),contentType:"application/json",headers:{"X-CSRF-TOKEN":t('meta[name="csrf-token"]').attr("content")},success:function(l){c(l.message,"success",2e3),setTimeout(()=>{window.location.href=l.redirect},500)},error:function(l){const u=l.responseJSON||{};c(u.message||"Gagal menyimpan perubahan","error",2e3),a.prop("disabled",!1).html(r)}})})}
